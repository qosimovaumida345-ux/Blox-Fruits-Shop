<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>AVG CLUB - Blox Fruits Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --teal: #38c2c2; --teal-dark: #266b6b; --bg-main: #f0fbfb; --text-main: #1b4d4d; --white: #ffffff; }
        body { margin: 0; font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg-main); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; }
        
        /* Yon Menu */
        .sidebar { width: 250px; background-color: var(--teal); color: var(--white); display: flex; flex-direction: column; padding-top: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
        .brand { text-align: center; font-size: 24px; font-weight: bold; margin-bottom: 30px; letter-spacing: 1px; }
        .sidebar-menu { list-style: none; padding: 0; margin: 0; }
        .sidebar-menu li { padding: 12px 20px; margin: 5px 15px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-weight: 500; font-size: 15px; transition: 0.3s; }
        .sidebar-menu li i { width: 20px; text-align: center; }
        .sidebar-menu li.active { background-color: var(--white); color: var(--teal); font-weight: bold; }
        .sidebar-menu li:hover:not(.active) { background-color: rgba(255,255,255,0.15); }

        /* Asosiy Qism */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: var(--white); padding: 15px 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.02); flex-wrap: wrap; gap: 15px;}
        .user-greeting { font-size: 18px; font-weight: 600; }
        .balance-badge { background-color: var(--teal); color: var(--white); padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 15px; }
        .tg-sync-btn { background-color: #0088cc; color: var(--white); border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        /* Navigatsiya tugmalari */
        .nav-tabs { display: flex; gap: 15px; margin-bottom: 25px; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; overflow-x: auto;}
        .nav-tabs button { background: transparent; border: none; font-size: 16px; font-weight: bold; color: var(--text-gray); cursor: pointer; padding: 10px 15px; transition: 0.3s; white-space: nowrap; }
        .nav-tabs button.active { color: var(--teal); border-bottom: 3px solid var(--teal); margin-bottom: -12px; }
        
        /* Kartochkalar (SMM dizaynida) */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .card-item { background: var(--white); border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); cursor: pointer; transition: 0.3s; overflow: hidden; border: 1px solid #e0e0e0; }
        .card-item:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(56, 194, 194, 0.2); border-color: var(--teal); }
        .card-img-area { background: #f8fafc; height: 180px; display: flex; justify-content: center; align-items: center; position: relative; }
        .card-img-area img { max-width: 110px; max-height: 110px; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.2)); transition: 0.3s; }
        .card-item:hover .card-img-area img { transform: scale(1.1); }
        .badge-price { position: absolute; top: 10px; left: 10px; background: var(--teal); color: white; padding: 5px 10px; border-radius: 8px; font-weight: bold; font-size: 13px; }
        .card-info { padding: 15px; text-align: center; border-top: 1px solid #e0e0e0; }
        .card-info h3 { margin: 0 0 5px 0; font-size: 16px; color: var(--text-main); }

        /* Forma va Modal */
        .card-panel { background: var(--white); border-radius: 12px; padding: 25px; box-shadow: 0 4px 20px rgba(0,100,100,0.04); margin-bottom: 25px; border-top: 4px solid var(--teal); }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-weight: 600; color: var(--teal-dark); margin-bottom: 8px; font-size: 14px;}
        .form-control { width: 100%; padding: 14px; border: 1px solid #e0e0e0; background-color: #fafafa; border-radius: 8px; font-size: 15px; box-sizing: border-box; outline: none; }
        .form-control:focus { border-color: var(--teal); background: var(--white); }
        .btn-submit { background-color: var(--teal); color: var(--white); border: none; width: 100%; padding: 15px; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.3s; }
        .btn-submit:hover { background-color: #2ab0b0; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; padding: 20px; box-sizing: border-box; backdrop-filter: blur(4px); }
        .modal-content { background: white; padding: 30px; border-radius: 16px; width: 100%; max-width: 400px; position: relative; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .close-btn { position: absolute; top: 15px; right: 15px; background: #f0fbfb; border: none; width: 32px; height: 32px; border-radius: 50%; font-size: 16px; color: var(--teal-dark); cursor: pointer; }
        
        .section-view { display: none; }
        .section-view.active { display: block; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand">AVG CLUB</div>
        <ul class="sidebar-menu">
            <li class="active" onclick="switchMainTab('shop', this)"><i class="fa-solid fa-store"></i> Do'kon</li>
            <li onclick="switchMainTab('deposit', this)"><i class="fa-solid fa-wallet"></i> Hisobni To'ldirish</li>
            <li style="margin-top: auto;" onclick="window.location.href='/auth/logout'"><i class="fa-solid fa-right-from-bracket"></i> Chiqish</li>
        </ul>
    </div>

    <div class="main-content">
        
        <div class="top-bar">
            <div class="user-greeting">Salom, <span style="color: var(--teal);"><%= user.username %></span> üëã</div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <div class="balance-badge">Balans: <%= user.balance %> UZS</div>
                <% if (!user.tg_id) { %>
                    <button class="tg-sync-btn" onclick="syncTelegram()"><i class="fa-brands fa-telegram"></i> Botga ulash</button>
                <% } else { %>
                    <span style="color: var(--teal-dark); font-weight: bold;"><i class="fa-brands fa-telegram" style="color: #0088cc;"></i> @<%= user.tg_username %></span>
                <% } %>
            </div>
        </div>

        <div id="shop" class="section-view active">
            
            <div class="nav-tabs">
                <button id="tab-fruits" class="active" onclick="loadCategory('fruits', this)">üçé Mevalar (Fruits)</button>
                <button id="tab-boost" onclick="loadCategory('boost', this)">‚ö°Ô∏è Boost & Passes</button>
                <button id="tab-accounts" onclick="loadCategory('accounts', this)">üéÆ Akkauntlar</button>
            </div>

            <div class="grid" id="products-grid">
                </div>
        </div>

        <div id="deposit" class="section-view">
            <div class="card-panel" style="text-align: center;">
                <h2 style="color: var(--teal-dark); margin-top:0;"><i class="fa-solid fa-credit-card"></i> Balansni To'ldirish</h2>
                <p style="font-size: 16px; line-height: 1.6; color: #4b5563;">Saytdagi hisobingizni to'ldirish uchun kerakli summani quyidagi karta raqamiga o'tkazing. To'lov qilingach, avtomatik SMS tizimi orqali balansingizga pul qo'shiladi.</p>
                <div style="background: var(--bg-main); border: 2px dashed var(--teal); color: var(--teal-dark); padding: 25px; border-radius: 12px; font-size: 28px; font-family: monospace; font-weight: bold; letter-spacing: 3px; margin: 30px 0;">
                    5614 6846 0556 8557
                </div>
                <p style="color: #dc2626; font-weight: bold; background: #fee2e2; padding: 10px; border-radius: 8px; display: inline-block;">Diqqat: To'lov izohiga hech narsa yozmang!</p>
            </div>
        </div>

    </div>

    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()"><i class="fa-solid fa-xmark"></i></button>
            <h2 style="text-align:center; margin-top: 0; color: var(--teal-dark);">Xaridni Tasdiqlash</h2>
            
            <div style="background: var(--bg-main); padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 20px; border: 1px solid #b2dfdb;">
                <span style="display:block; font-size: 14px; color: var(--text-gray);">Xarid qilinmoqda:</span>
                <b id="selectedItemName" style="font-size: 18px; color: var(--teal-dark);"></b>
            </div>

            <div class="form-group">
                <label class="form-label">Roblox Username (Nikingiz)</label>
                <input type="text" class="form-control" id="robloxUser" placeholder="Misol: rip_indra...">
            </div>

            <p style="text-align: center; color: #dc2626; font-size: 14px; display: none; font-weight: bold;" id="error-msg"></p>

            <button class="btn-submit" id="order-btn" onclick="processPayment()"><i class="fa-solid fa-bag-shopping"></i> Balansdan to'lash</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        let currentSelectedItem = "";
        let currentSelectedPrice = "";

        // 1. TO'LIQ MEVALAR BAZASI (HECH NIMA QISQARTIRILMADI)
        const fruitsData = [
            { name: "Rocket", price: "1,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/c/cb/Rocket_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027120039" },
            { name: "Spin", price: "1,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/8/88/Spin_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027120258" },
            { name: "Blade", price: "1,500", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/0/01/Blade_Fruit.png/revision/latest/scale-to-width-down/110?cb=20241215033604" },
            { name: "Spring", price: "1,500", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/8/8a/Spring_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027120418" },
            { name: "Bomb", price: "2,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/4/43/Bomb_Fruit.png/revision/latest/scale-to-width-down/110?cb=20240304195914" },
            { name: "Smoke", price: "2,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/7/7e/Smoke_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027120224" },
            { name: "Spike", price: "3,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/c/ce/Spike_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027120251" },
            { name: "Ice", price: "4,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/c/c5/Ice_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115604" },
            { name: "Sand", price: "4,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/7/72/Sand_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027120103" },
            { name: "Dark", price: "4,500", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/5/5c/Dark_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115358" },
            { name: "Eagle", price: "5,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/5/53/Eagle_Fruit.png/revision/latest/scale-to-width-down/110?cb=20250418030931" },
            { name: "Diamond", price: "5,500", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/8/88/Diamond_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115405" },
            { name: "Light", price: "8,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/8/83/Light_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115623" },
            { name: "Rubber", price: "8,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/5/5c/Rubber_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027120046" },
            { name: "Ghost", price: "8,500", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/8/8c/Ghost_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115804" },
            { name: "Magma", price: "9,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/2/27/Magma_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115640" },
            { name: "Quake", price: "10,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/4/42/Quake_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115754" },
            { name: "Buddha", price: "15,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/d/df/Buddha_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115325" },
            { name: "Love", price: "12,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/b/b3/Love_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115630" },
            { name: "Creation", price: "14,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/4/44/Creation_Fruit.png/revision/latest/scale-to-width-down/110?cb=20250913215446" },
            { name: "Spider", price: "12,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/6/61/Spider_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027120241" },
            { name: "Sound", price: "15,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/b/ba/Sound_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027120231" },
            { name: "Phoenix", price: "15,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/f/fc/Phoenix_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115733" },
            { name: "Portal", price: "18,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/8/8a/Portal_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115746" },
            { name: "Lightning", price: "18,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/7/78/Lightning_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027120057" },
            { name: "Pain", price: "12,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/4/40/Pain_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115724" },
            { name: "Blizzard", price: "16,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/c/c9/Blizzard_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115313" },
            { name: "Gravity", price: "20,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/5/5f/Gravity_Fruit.png/revision/latest/scale-to-width-down/110?cb=20250418030958" },
            { name: "Mammoth", price: "22,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/9/95/Mammoth_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115702" },
            { name: "T-Rex", price: "25,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/d/d9/T-Rex_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231226191220" },
            { name: "Dough", price: "28,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/0/02/Dough_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231210155057" },
            { name: "Shadow", price: "22,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/5/58/Shadow_Fruit.png/revision/latest/scale-to-width-down/110?cb=20241229033053" },
            { name: "Venom", price: "25,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/d/d2/Venom_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027120425" },
            { name: "Gas", price: "26,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/e/ed/Gas_Fruit.png/revision/latest/scale-to-width-down/110?cb=20241223162315" },
            { name: "Spirit", price: "25,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/6/66/Spirit_Fruit.png/revision/latest/scale-to-width-down/110?cb=20240304190559" },
            { name: "Tiger", price: "35,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/1/14/Tiger_Fruit.png/revision/latest/scale-to-width-down/110?cb=20251101005924" },
            { name: "Yeti", price: "30,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/2/2f/Yeti_Fruit.png/revision/latest/scale-to-width-down/110?cb=20241226020230" },
            { name: "Control", price: "22,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/1/19/Control_Fruit.png/revision/latest/scale-to-width-down/110?cb=20251223165924" },
            { name: "Dragon", price: "50,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/2/29/Dragon_Fruit.png/revision/latest/scale-to-width-down/110?cb=20241218114129" },
            { name: "Kitsune", price: "45,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/6/65/Kitsune_Fruit.png/revision/latest/scale-to-width-down/110?cb=20241223162956" }
        ];

        const boostData = [
            { name: "Raid Help", price: "5,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/3/30/Microchip.png/revision/latest/scale-to-width-down/110?cb=20220910123512" },
            { name: "Race V3 / V4", price: "25,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/8/87/Mirror_Fractal.png/revision/latest/scale-to-width-down/110?cb=20230113190823" },
            { name: "Level Max Boost", price: "40,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/1/15/2X_EXP_Boost.png/revision/latest/scale-to-width-down/110?cb=20210214150536" }
        ];

        const accountData = [
            { name: "Max + Kitsune Acc", price: "150,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/6/65/Kitsune_Fruit.png/revision/latest/scale-to-width-down/110?cb=20241223162956" },
            { name: "Starter Smurf Acc", price: "30,000", img: "https://static.wikia.nocookie.net/roblox-blox-piece/images/d/df/Buddha_Fruit.png/revision/latest/scale-to-width-down/110?cb=20231027115325" }
        ];

        // 2. YON MENU ALMASHTIRISH (Do'kon va To'ldirish)
        function switchMainTab(tabId, element) {
            document.querySelectorAll('.section-view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.sidebar-menu li').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            element.classList.add('active');
        }

        // 3. KATEGORIYALARNI (MEVALAR, BOOST, ACC) CHIQARISH
        function loadCategory(category, element) {
            const grid = document.getElementById('products-grid');
            document.querySelectorAll('.nav-tabs button').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            grid.innerHTML = '';
            
            let data = [];
            if(category === 'fruits') data = fruitsData;
            else if (category === 'boost') data = boostData;
            else if (category === 'accounts') data = accountData;

            data.forEach(item => {
                grid.innerHTML += `
                    <div class="card-item" onclick="openModal('${item.name}', '${item.price}')">
                        <div class="card-img-area">
                            <span class="badge-price">${item.price} UZS</span>
                            <img src="${item.img}" alt="${item.name}" onerror="this.src='https://static.wikia.nocookie.net/roblox-blox-piece/images/5/5c/Rubber_Fruit.png'">
                        </div>
                        <div class="card-info">
                            <h3>${item.name}</h3>
                        </div>
                    </div>`;
            });
        }

        // 4. MODAL FUNKSIYALARI
        function openModal(name, price) {
            currentSelectedItem = name; 
            currentSelectedPrice = price;
            document.getElementById('selectedItemName').innerText = `${name} - ${price} UZS`;
            document.getElementById('error-msg').style.display = 'none';
            document.getElementById('paymentModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('paymentModal').style.display = 'none'; }

        // 5. TG ULASH VA BUYURTMA BERISH API LARI
        async function syncTelegram() {
            const user = tg.initDataUnsafe?.user;
            if(!user) return alert("Iltimos, saytni Telegram botingiz orqali oching!");
            const res = await fetch('/api/sync-telegram', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ tg_id: user.id, tg_username: user.username }) });
            if((await res.json()).success) location.reload();
        }

        async function processPayment() {
            const nik = document.getElementById('robloxUser').value.trim();
            const errorMsg = document.getElementById('error-msg');
            const btn = document.getElementById('order-btn');

            if(nik.length < 3) { 
                errorMsg.innerText = "Iltimos, Roblox nikingizni yozing!"; 
                errorMsg.style.display = 'block'; 
                return; 
            }

            btn.innerText = "Kuting..."; btn.disabled = true;

            try {
                const res = await fetch('/api/buyurtma', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ robloxNik: nik, meva: currentSelectedItem, price: currentSelectedPrice })
                });
                const data = await res.json();
                
                if(data.success) {
                    alert(`‚úÖ Xarid tasdiqlandi! Admin siz bilan tez orada bog'lanadi.`);
                    location.reload();
                } else {
                    errorMsg.innerText = data.error;
                    errorMsg.style.display = 'block';
                }
            } catch (err) { 
                errorMsg.innerText = "Server xatosi.";
                errorMsg.style.display = 'block';
            } finally {
                btn.innerText = "Balansdan to'lash"; btn.disabled = false;
            }
        }

        // Sayt ishlaganda birinchi bo'lib Mevalar bo'limi ochiladi
        window.onload = () => loadCategory('fruits', document.getElementById('tab-fruits'));
    </script>
</body>
</html>

